"use strict";function PodcastPanelDirective(){return{restrict:"E",templateUrl:"partials/directives/podcast-panel.html"}}function PreloaderDirective(){return{restrict:"E",templateUrl:"partials/directives/preloader.html"}}function PreloaderSmallDirective(){return{restrict:"E",templateUrl:"partials/directives/preloader-small.html"}}function PreloaderSmallBlueDirective(){return{restrict:"E",templateUrl:"partials/directives/preloader-small-blue.html"}}function PodcastEpisodeDirective(){return{restrict:"E",templateUrl:"partials/directives/podcast-episode.html"}}function ngRightClick(e){return function(t,a,o){var s=e(o.ngRightClick);a.bind("contextmenu",function(e){t.$apply(function(){e.preventDefault(),s(t,{$event:e})})})}}function routeConfig(e,t){e.state("home",{url:"/",views:{main:{templateUrl:"partials/home.html"}}}).state("podcast",{url:"/podcast/{id}",views:{main:{templateUrl:"partials/podcast.html"}}}).state("settings",{url:"/settings",views:{main:{templateUrl:"partials/settings.html"}}}).state("about",{url:"/about",views:{main:{templateUrl:"partials/about.html"}}}).state("playPodcast",{url:"/play/{podcast}/{episode}",views:{main:{templateUrl:"partials/player.html"}}})}function runBlock(e,t,a,o){t.nowPlaying={},t.podcasts=[],Zeus.loadSettings(function(e){void 0===e.theme?t.settings={theme:"light",animations:!0,analytics:!0,voiceBoost:!0,smartSpeed:!0,autoPlay:!0,volume:50,cacheImages:!0,autoUpdate:!0,playback:"download"}:t.settings=e,Zeus.settings=t.settings,Zeus.loadSavedPodcasts(function(e){console.log(e),t.podcasts=e,t.fullyLoaded=!0})})}function HomePageCtrl(e,t,a,o,s,n,l){function c(){for(var t=null,a=0;a<e.podcasts.length;a++)if(e.podcasts[a].selected){t=a;break}return t}function r(e,t){Zeus.searchPodcastOnITunes(e,function(e,a){if(e)throw e;console.log(a.results),t.resolve(a.results)})}var d;e.podcasts=t.podcasts,e.podcastInfo={},console.log(e.podcasts),e.closePodcastModal=function(){n.hide()},e.openPodcastModal=function(e){n.show({parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,contentElement:"#addPodcastModal"})},e.addNewPodcast=function(t){return e.podcastInfo.hasError=!1,e.loadingRSSFeed=!0,t.url.match(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/)?void Zeus.fetchPodcastRSS(t.url,!0,null,function(t,o){return t||!o?(e.podcastInfo.errorMessage="Error: "+String(t),e.podcastInfo.hasError=!0,void(e.loadingRSSFeed=!1)):(e.podcastInfo.url="",e.loadingRSSFeed=!1,void a(function(){n.hide(),e.loadingPodcasts=!1,e.$apply()},2e3))}):(e.podcastInfo.errorMessage="Invalid URL",e.podcastInfo.hasError=!0,void(e.loadingRSSFeed=!1))},e.searchForPodcast=function(e){var t=s.defer();return console.log(e),a.cancel(d),d=a(function(){r(e,t)},2e3),t.promise},e.autocompleteSelectItem=function(t){e.podcastInfo.url=t.feedUrl},e.refreshAllPodcasts=function(){for(var a=0;a<e.podcasts.length;a++)t.podcasts[a].loading=!0,Zeus.fetchPodcastRSS(e.podcasts[a].rssUrl,!1,e.podcasts[a].id,function(a,o,s){t.podcasts[s]=o,t.podcasts[s].loading=!1,e.podcasts[s].loading=!1,console.log(t.podcasts),e.$apply()})},e.selectPodcast=function(t,a){e.handlePodcastUnselect(a),e.podcasts[t.id].selected=!0},e.handlePodcastUnselect=function(t){if(!angular.element(t.srcElement).parent().attr("data-context-menu"))for(var a=0;a<e.podcasts.length;a++)e.podcasts[a].selected=!1},e.sharePodcast=function(e){c();n.show({parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,contentElement:"#sharePodcastModal"})},e.openPodcastWebpage=function(t){var a=c();shell.openExternal(e.podcasts[a].meta.link)},e.downloadAllPodcasts=function(e){c()},e.deletePodcast=function(t){var a=c(),o=n.confirm().title('Remove podcast podcast "'+e.podcasts[a].meta.title+'"?').ariaLabel("Remove podcast").targetEvent(t).ok("Remove").cancel("Cancel");n.show(o).then(function(){var t=e.podcasts[a].meta.title;console.log("You chose to delete!"),Zeus.removePodcast(a),console.log("Showing toast!"),l.show({hideDelay:3e3,position:"bottom left",template:'\n        <md-toast style="max-width: 500px; bottom: 10px; left: 10px;">\n          <span class="md-toast-text">Deleted podcast "'+t+'"</span>\n          <md-button class="md-accent" ng-click="undoLastDelete($event)">\n            Undo\n          </md-button>\n          <md-button ng-click="closeToast($event)">\n            Close\n          </md-button>\n        </md-toast>\n        '})})},o.on("click",function(t){e.handlePodcastUnselect(t)})}function MainCtrl(e,t,a,o,s,n,l,c,r,d){e.podcastPlayer={},e.podcastPlayer.isADifferentEpisode=!0,e.podcastPlayer.onPodcastPage=!1,e.podcastPlayer.podcast={},e.podcastPlayer.episode={},e.closeToast=function(){c.hide()},e.hideFrame=function(){Main.hideWindow()},e.closeFrame=function(){Main.closeWindow()},s.on("click",function(e){e.srcElement.href&&e.srcElement.href.includes("http")&&(shell.openExternal(e.srcElement.href),e.preventDefault())}),t.$on("$stateChangeSuccess",function(a,s,c,i,p){return e.closeToast(),"playPodcast"==s.name?(e.podcastPlayer.onPodcastPage=!0,e.podcastPlayer.isADifferentEpisode=!1,c.podcast!=e.podcastPlayer.podcast.id&&c.episode!=e.podcastPlayer.episode.id&&(e.podcastPlayer.isADifferentEpisode=!0,void 0!==e.podcastPlayer.playback&&(e.podcastPlayer.playback.pausePodcast(),e.podcastPlayer.sound=null)),void PlayerPageCtrl(e,t,o,n,l,r,d)):void(e.podcastPlayer.onPodcastPage=!1)})}function PlayerPageCtrl(e,t,a,o,s,n,l){e.podcastPlayer.isADifferentEpisode&&(e.podcastPlayer.hasAPodcastPlaying=!0,e.podcastPlayer.showNotes=!1,e.podcastPlayer.alreadyCanPlayed=!1,e.podcastPlayer.podcast=t.podcasts[a.params.podcast],e.podcastPlayer.episode=t.podcasts[a.params.podcast].podcasts[a.params.episode],e.podcastPlayer.episode.playbackURL="../../userdata/podcasts/"+e.podcastPlayer.episode.hash+".mp3",e.podcastPlayer.updateInterval=null,t.nowPlaying.playing=!0,t.nowPlaying.podcastId=a.params.podcast,t.nowPlaying.episodeId=a.params.episode,e.podcastPlayer.sound=l.load(e.podcastPlayer.episode.playbackURL),e.podcastPlayer.playback={currentlyPlaying:!1,hoverTime:"0:00:00",tooltipLeft:0,tooltipTop:0,showHoverPosition:!1,progress:0,volume:t.settings.volume,lastEpisode:function(){location.assign("#/play/"+a.params.podcast+"/"+(parseInt(a.params.episode)+1)),e.podcastPlayer.sound.pause()},replay10Seconds:function(){e.podcastPlayer.sound.currentTime-=10},playPodcast:function(){e.podcastPlayer.playback.currentlyPlaying=!0,e.podcastPlayer.sound.play(),e.podcastPlayer.updateInterval=o(function(){e.podcastPlayer.episode.currentTime=e.podcastPlayer.sound.currentTime,Zeus.updateSavedPodcast(e.podcastPlayer.podcast)},3e4)},pausePodcast:function(){e.podcastPlayer.playback.currentlyPlaying=!1,e.podcastPlayer.sound.pause(),angular.isDefined(e.podcastPlayer.updateInterval)&&(o.cancel(e.podcastPlayer.updateInterval),e.podcastPlayer.updateInterval=void 0)},forward30Seconds:function(){e.podcastPlayer.sound.currentTime+=30},nextEpisode:function(){location.assign("#/play/"+a.params.podcast+"/"+(parseInt(a.params.episode)-1)),e.podcastPlayer.sound.pause()},goToPosition:function(t){var a=document.getElementsByTagName("md-progress-linear")[0].clientWidth,o=t.offsetX,s=(o/a).round(4);e.podcastPlayer.sound.currentTime=Math.round((e.podcastPlayer.sound.remaining+e.podcastPlayer.sound.currentTime)*s)},showPosition:function(t){var a=document.getElementsByTagName("md-progress-linear")[0].clientWidth,o=t.offsetX,s=(o/a).round(4);e.podcastPlayer.playback.hoverTime=parseTime(Math.floor((e.podcastPlayer.sound.remaining+e.podcastPlayer.sound.currentTime)*s)),e.podcastPlayer.playback.tooltipLeft=t.pageX-28+"px",e.podcastPlayer.playback.tooltipTop=angular.element(document.querySelector("md-progress-linear")).prop("offsetTop")-23+"px",e.podcastPlayer.playback.showHoverPosition=!0}},e.podcastPlayer.sound.volume=e.podcastPlayer.playback.volume/100,n.bindTo(e).add({combo:"j",description:"Rewinds the podcast 10 seconds",callback:function(t,a){t.preventDefault(),e.podcastPlayer.playback.replay10Seconds()}}).add({combo:"k",description:"Pauses the currently playing podcast",callback:function(t,a){t.preventDefault(),e.podcastPlayer.playback.currentlyPlaying?e.podcastPlayer.playback.pausePodcast():e.podcastPlayer.playback.playPodcast()}}).add({combo:"l",description:"Skips forward 30 seconds",callback:function(t,a){t.preventDefault(),e.podcastPlayer.playback.forward30Seconds()}}),e.$watch("podcastPlayer.playback.volume",function(){e.podcastPlayer.sound.volume=e.podcastPlayer.playback.volume/100}),e.$watch("podcastPlayer.sound.canPlay",function(){e.podcastPlayer.alreadyCanPlayed||(e.podcastPlayer.alreadyCanPlayed=!0,s(function(){e.podcastPlayer.sound.currentTime=e.podcastPlayer.episode.currentTime||0,document.querySelector('span[ng-click="podcastPlayer.playback.playPodcast()"]').click()},100))}))}function parseTime(e){var t=e,a="",o=0,s=0,n=0;return t>3599?(o=Math.floor(t/3600),s=Math.floor((t-3600*o)/60),n=t-(60*s+3600*o),1==o.toString().length&&(o="0"+Math.floor(t/3600).toString()),1==s.toString().length&&(s="0"+Math.floor((t-3600*o)/60).toString()),1==n.toString().length&&(n="0"+(t-(60*s+3600*o)).toString()),a=o+":"+s+":"+n):t>59?(s=Math.floor(t/60),n=t-60*s,1==s.toString().length&&(s="0"+Math.floor(t/60).toString()),1==n.toString().length&&(n="0"+(t-60*s).toString()),a=s+":"+n):(n=t,1==n.toString().length&&(n="0"+t.toString()),a=(t<10?"00:0":"00:")+t),a}function PodcastPageCtrl(e,t,a,o,s){if(e.podcast=t.podcasts[a.params.id],e.showUnplayedOnly=!0,!e.podcast)return void o.url("/");for(var n=0;n<e.podcast.podcasts.length;n++)e.podcast.podcasts[n].downloading=!1;e.downloadEpisode=function(t){e.podcast.podcasts[t].downloading=!0,e.podcast.podcasts[t].downloadPercent=0,Zeus.downloadEpisode(e.podcast.podcasts[t],function(a,o,n){return 1!=n?(console.log(n),e.podcast.podcasts[t].downloadPercent=n,void e.$apply()):(e.podcast.podcasts[t].downloadPercent=1,e.$apply(),void s(function(){e.podcast.podcasts[t].downloading=!1,e.podcast.podcasts[t].isDownloaded=!0},1e3))})},e.deleteEpisode=function(t){Zeus.deleteEpisode(e.podcast.podcasts[t],function(a){a&&(e.podcast.podcasts[t].isDownloaded=!1)})},e.playPodcast=function(t,a){e.podcast.podcasts[a].isDownloaded&&o.url("/play/"+t+"/"+a)},e.markAsWatched=function(t){e.podcast.podcasts[t].watched=!0,Zeus.updateSavedPodcast(e.podcast)}}function SettingPageCtrl(e,t){e.showAdvancedSettings=!1,e.settings=t.settings,e.saveSettings=function(){t.settings=e.settings,Zeus.saveSettings(t.settings)},e.revertSettings=function(){e.settings={theme:"light",animations:!0,analytics:!0,smartSpeed:!0,voiceBoost:!0,autoPlay:!0,volume:50,cacheImages:!0,autoUpdate:!0,playback:"download"},e.saveSettings()}}ngRightClick.$inject=["$parse"],routeConfig.$inject=["$stateProvider","$locationProvider"],runBlock.$inject=["$window","$rootScope","$location","$interval"],HomePageCtrl.$inject=["$scope","$rootScope","$timeout","$document","$q","$mdDialog","$mdToast"],MainCtrl.$inject=["$scope","$rootScope","$window","$state","$document","$interval","$timeout","$mdToast","hotkeys","ngAudio"],SettingPageCtrl.$inject=["$scope","$rootScope"],PodcastPageCtrl.$inject=["$scope","$rootScope","$state","$location","$timeout"];var zeus=angular.module("zeus",["ui.router","ngAudio","ngAnimate","ngMaterial","ngContextMenu","ngSanitize","cfp.hotkeys"]).config(routeConfig).config(["hotkeysProvider",function(e){e.includeCheatSheet=!1}]);angular.module("zeus").directive("podcastPanel",PodcastPanelDirective).directive("preloader",PreloaderDirective).directive("preloaderSmall",PreloaderSmallDirective).directive("preloaderSmallBlue",PreloaderSmallBlueDirective).directive("podcastEpisode",PodcastEpisodeDirective).directive("ngRightClick",ngRightClick),Number.prototype.round=function(e){return e=e||10,parseFloat(this.toFixed(e))};var shell=require("electron").shell;angular.module("zeus").run(runBlock);var remote=require("electron").remote,Menu=remote.Menu,MenuItem=remote.MenuItem,template=[{label:"Copy",accelerator:"CmdOrCtrl+C",role:"copy"},{label:"Reload",accelerator:"CmdOrCtrl+R",click:function(e,t){t&&t.reload()}},{label:"Toggle Dev. Tools",accelerator:"darwin"===process.platform?"Alt+Command+I":"Ctrl+Shift+I",click:function(e,t){t&&t.webContents.toggleDevTools()}}],menu=Menu.buildFromTemplate(template);angular.module("zeus").controller("HomePageCtrl",HomePageCtrl),angular.module("zeus").controller("MainCtrl",MainCtrl),angular.module("zeus").controller("PodcastPageCtrl",PodcastPageCtrl),angular.module("zeus").controller("SettingPageCtrl",SettingPageCtrl);