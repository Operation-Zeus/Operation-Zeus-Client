/*! operation-zeus 2016-09-22 */
function PodcastPanelDirective(){return{restrict:"E",templateUrl:"partials/podcast-panel.html"}}function PreloaderDirective(){return{restrict:"E",templateUrl:"partials/preloader.html"}}function PreloaderSmallDirective(){return{restrict:"E",templateUrl:"partials/preloader-small.html"}}function PreloaderSmallBlueDirective(){return{restrict:"E",templateUrl:"partials/preloader-small-blue.html"}}function PodcastEpisodeDirective(){return{restrict:"E",templateUrl:"partials/podcast-episode.html"}}function runBlock($window,$rootScope,$location,$interval){$rootScope.nowPlaying={},$rootScope.podcasts=[],Zeus.loadSettings(function(data){void 0===data.darkTheme?$rootScope.settings={theme:"light",animations:!0,analytics:!0,autoplay:!0,volume:50,cacheImages:!0,autoUpdate:!0,playback:"download"}:$rootScope.settings=data,Zeus.settings=$rootScope.settings,Zeus.loadSavedPodcasts(function(data){console.log(data),$rootScope.podcasts=data,$rootScope.fullyLoaded=!0})})}function PlayerPageCtrl($scope,$rootScope,$state,$location,$interval,$timeout,ngAudio){$scope.podcast=$rootScope.podcasts[$state.params.podcast],$scope.episode=$rootScope.podcasts[$state.params.podcast].podcasts[$state.params.episode],$scope.episode.playbackURL="../../userdata/podcasts/"+$scope.episode.hash+".mp3",$rootScope.nowPlaying.playing=!0,$rootScope.nowPlaying.podcastId=$state.params.podcast,$rootScope.nowPlaying.episodeId=$state.params.episode;var updateInterval=null;ngAudio.unlock=void 0,$scope.sound=ngAudio.load("../../userdata/podcasts/"+$scope.episode.hash+".mp3"),$scope.playback={currentlyPlaying:!1,hoverTime:"0:00:00",tooltipLeft:0,tooltipTop:0,showHoverPosition:!1,lastEpisode:function(){$location.url("/play/"+$route.current.params.podcast+"/"+(parseInt($route.current.params.episode)+1)),$scope.sound.pause()},replay10Seconds:function(){$scope.sound.currentTime-=10},playPodcast:function(){$scope.playback.currentlyPlaying=!0,$scope.sound.play(),updateInterval=$interval(function(){$scope.episode.currentTime=$scope.sound.currentTime,Zeus.updateSavedPodcast($scope.podcast)},3e4)},pausePodcast:function(){$scope.playback.currentlyPlaying=!1,$scope.sound.pause(),angular.isDefined(updateInterval)&&($interval.cancel(updateInterval),updateInterval=void 0)},forward30Seconds:function(){$scope.sound.currentTime+=30},nextEpisode:function(){$location.url("/play/"+$route.current.params.podcast+"/"+(parseInt($route.current.params.episode)-1)),$scope.sound.pause()},goToPosition:function(e){var totalWidth=document.getElementsByTagName("md-progress-linear")[0].clientWidth,clickedAt=e.offsetX,percent=(clickedAt/totalWidth).round(4);$scope.sound.currentTime=Math.round(($scope.sound.remaining+$scope.sound.currentTime)*percent)},showPosition:function(e){var totalWidth=document.getElementsByTagName("md-progress-linear")[0].clientWidth,clickedAt=e.offsetX,percent=(clickedAt/totalWidth).round(4);$scope.playback.hoverTime=parseTime(Math.floor(($scope.sound.remaining+$scope.sound.currentTime)*percent)),$scope.playback.tooltipLeft=e.pageX-28,$scope.playback.tooltipTop=angular.element(document.querySelector("md-progress-linear")).prop("offsetTop")-23,$scope.playback.showHoverPosition=!0}},$timeout(function(){$scope.sound.currentTime=$scope.episode.currentTime||0},400),angular.element(document.querySelector('[data-bind="episode.description"]')).html($scope.episode.description),$scope.$on("destroy",function(){console.log("Scope destroyed!"),$scope.playback.pausePodcast()})}function parseTime(input){var totalSec=input,output="",hours=0,minutes=0,seconds=0;return totalSec>3599?(hours=Math.floor(totalSec/3600),minutes=Math.floor((totalSec-3600*hours)/60),seconds=totalSec-(60*minutes+3600*hours),1==hours.toString().length&&(hours="0"+Math.floor(totalSec/3600).toString()),1==minutes.toString().length&&(minutes="0"+Math.floor((totalSec-3600*hours)/60).toString()),1==seconds.toString().length&&(seconds="0"+(totalSec-(60*minutes+3600*hours)).toString()),output=hours+":"+minutes+":"+seconds):totalSec>59?(minutes=Math.floor(totalSec/60),seconds=totalSec-60*minutes,1==minutes.toString().length&&(minutes="0"+Math.floor(totalSec/60).toString()),1==seconds.toString().length&&(seconds="0"+(totalSec-60*minutes).toString()),output=minutes+":"+seconds):(seconds=totalSec,1==seconds.toString().length&&(seconds="0"+totalSec.toString()),output=(totalSec<10?"00:0":"00:")+totalSec),output}function PodcastPageCtrl($scope,$rootScope,$state,$location,$timeout){if($scope.podcast=$rootScope.podcasts[$state.params.id],$scope.showUnplayedOnly=!0,!$scope.podcast)return void $location.url("/");for(var i=0;i<$scope.podcast.podcasts.length;i++)$scope.podcast.podcasts[i].downloading=!1;$scope.downloadEpisode=function(id){$scope.podcast.podcasts[id].downloading=!0,$scope.podcast.podcasts[id].downloadPercent=0,Zeus.downloadEpisode($scope.podcast.podcasts[id],function(error,success,percent){return 1!=percent?(console.log(percent),$scope.podcast.podcasts[id].downloadPercent=percent,void $scope.$apply()):($scope.podcast.podcasts[id].downloadPercent=1,$scope.$apply(),void $timeout(function(){$scope.podcast.podcasts[id].downloading=!1,$scope.podcast.podcasts[id].isDownloaded=!0},1e3))})},$scope.deleteEpisode=function(id){Zeus.deleteEpisode($scope.podcast.podcasts[id],function(success){success&&($scope.podcast.podcasts[id].isDownloaded=!1)})},$scope.playPodcast=function(podcast,episode){$scope.podcast.podcasts[episode].isDownloaded&&$location.url("/play/"+podcast+"/"+episode)},$scope.markAsWatched=function(id){$scope.podcast.podcasts[id].watched=!0,Zeus.updateSavedPodcast($scope.podcast)}}var zeus=angular.module("zeus",["ui.router","ngAudio","ngAnimate","ngMaterial","ngContextMenu"]).config(["$stateProvider",function($stateProvider){$stateProvider.state("home",{url:"/",views:{main:{templateUrl:"partials/home.html"}}}).state("podcast",{url:"/podcast/{id}",views:{main:{templateUrl:"partials/podcast.html"}}}).state("settings",{url:"/settings",views:{main:{templateUrl:"partials/settings.html"}}}).state("about",{url:"/about",views:{main:{templateUrl:"partials/about.html"}}}).state("playPodcast",{url:"/play/{podcast}/{episode}",views:{main:{templateUrl:"partials/player.html"}}})}]);angular.module("zeus").directive("podcastPanel",PodcastPanelDirective).directive("preloader",PreloaderDirective).directive("preloaderSmall",PreloaderSmallDirective).directive("preloaderSmallBlue",PreloaderSmallBlueDirective).directive("podcastEpisode",PodcastEpisodeDirective),Number.prototype.round=function(p){return p=p||10,parseFloat(this.toFixed(p))};const shell=require("electron").shell;angular.module("zeus").run(runBlock);const remote=require("electron").remote,Menu=remote.Menu,MenuItem=remote.MenuItem,template=[{label:"Copy",accelerator:"CmdOrCtrl+C",role:"copy"},{label:"Reload",accelerator:"CmdOrCtrl+R",click:function(item,focusedWindow){focusedWindow&&focusedWindow.reload()}},{label:"Toggle Dev. Tools",accelerator:"darwin"===process.platform?"Alt+Command+I":"Ctrl+Shift+I",click:function(item,focusedWindow){focusedWindow&&focusedWindow.webContents.toggleDevTools()}}],menu=Menu.buildFromTemplate(template);zeus.controller("HomePageCtrl",["$scope","$rootScope","$timeout","$mdDialog",function($scope,$rootScope,$timeout,$mdDialog){$scope.podcasts=$rootScope.podcasts,console.log($scope.podcasts),$scope.closePodcastModal=function(){$mdDialog.hide()},$scope.openPodcastModal=function(e){$mdDialog.show({parent:angular.element(document.body),targetEvent:e,clickOutsideToClose:!0,contentElement:"#addPodcastModal"})},$scope.addNewPodcast=function(podcastInfo){return $scope.podcastInfo.hasError=!1,$scope.loadingRSSFeed=!0,podcastInfo.url.match(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/)?void Zeus.fetchPodcastRSS(podcastInfo.url,!0,null,function(err,podcast){return err||!podcast?($scope.podcastInfo.errorMessage="Error: "+String(err),$scope.podcastInfo.hasError=!0,void($scope.loadingRSSFeed=!1)):($scope.podcastInfo.url="",$scope.loadingRSSFeed=!1,void $timeout(function(){$mdDialog.hide(),$scope.loadingPodcasts=!1,$scope.$apply()},2e3))}):($scope.podcastInfo.errorMessage="Invalid URL",$scope.podcastInfo.hasError=!0,void($scope.loadingRSSFeed=!1))},$scope.refreshAllPodcasts=function(){for(var i=0;i<$scope.podcasts.length;i++)$rootScope.podcasts[i].loading=!0,Zeus.fetchPodcastRSS($scope.podcasts[i].rssUrl,!1,$scope.podcasts[i].id,function(err,podcast,index){$rootScope.podcasts[index]=podcast,$rootScope.podcasts[index].loading=!1,$scope.podcasts[index].loading=!1,console.log($rootScope.podcasts),$scope.$apply()})}}]),zeus.controller("MainCtrl",["$scope","$rootScope","$window","$location","$document",function($scope,$rootScope,$window,$location,$document){$rootScope.$on("$routeChangeError",function(event,curr,prev,rejection){return prev?void $window.history.back():void $location.url("/")}),$scope.hideFrame=function(){Main.hideWindow()},$scope.closeFrame=function(){Main.closeWindow()},$document.on("click",function(e){e.srcElement.href&&e.srcElement.href.includes("http")&&(shell.openExternal(e.srcElement.href),e.preventDefault())})}]),angular.module("zeus").controller("PlayerPageCtrl",PlayerPageCtrl),PlayerPageCtrl.$inject=["$scope","$rootScope","$state","$location","$interval","$timeout","ngAudio"],angular.module("zeus").controller("PodcastPageCtrl",PodcastPageCtrl),PodcastPageCtrl.$inject=["$scope","$rootScope","$state","$location","$timeout"],zeus.controller("SettingPageCtrl",["$scope","$rootScope",function($scope,$rootScope){$scope.showAdvancedSettings=!1,$scope.settings=$rootScope.settings,$scope.saveSettings=function(){$rootScope.settings={theme:$scope.settings.theme,animations:$scope.settings.animations,analytics:$scope.settings.analytics,autoplay:$scope.settings.autoplay,volume:$scope.settings.volumeRange,cacheImages:$scope.settings.cacheImages,autoUpdate:$scope.settings.autoUpdate,playback:$scope.settings.playback},Zeus.saveSettings($rootScope.settings)},$scope.revertSettings=function(){$scope.settings={theme:"light",animations:!0,analytics:!0,autoplay:!0,volume:50,cacheImages:!0,autoUpdate:!0,playback:"download"},$scope.saveSettings()}}]);