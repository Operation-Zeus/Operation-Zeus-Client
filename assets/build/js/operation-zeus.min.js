/*! operation-zeus 2016-09-28 */
function PodcastPanelDirective(){return{restrict:"E",templateUrl:"partials/directives/podcast-panel.html"}}function PreloaderDirective(){return{restrict:"E",templateUrl:"partials/directives/preloader.html"}}function PreloaderSmallDirective(){return{restrict:"E",templateUrl:"partials/directives/preloader-small.html"}}function PreloaderSmallBlueDirective(){return{restrict:"E",templateUrl:"partials/directives/preloader-small-blue.html"}}function PodcastEpisodeDirective(){return{restrict:"E",templateUrl:"partials/directives/podcast-episode.html"}}function ngRightClick(a){return function(b,c,d){var e=a(d.ngRightClick);c.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault(),e(b,{$event:a})})})}}function routeConfig(a,b){a.state("home",{url:"/",views:{main:{templateUrl:"partials/home.html"}}}).state("podcast",{url:"/podcast/{id}",views:{main:{templateUrl:"partials/podcast.html"}}}).state("settings",{url:"/settings",views:{main:{templateUrl:"partials/settings.html"}}}).state("about",{url:"/about",views:{main:{templateUrl:"partials/about.html"}}}).state("playPodcast",{url:"/play/{podcast}/{episode}",views:{main:{templateUrl:"partials/player.html"}}})}function runBlock(a,b,c,d){b.nowPlaying={},b.podcasts=[],Zeus.loadSettings(function(a){void 0===a.darkTheme?b.settings={theme:"light",animations:!0,analytics:!0,voiceBoost:!0,smartSpeed:!0,autoPlay:!0,volume:50,cacheImages:!0,autoUpdate:!0,playback:"download"}:b.settings=a,Zeus.settings=b.settings,Zeus.loadSavedPodcasts(function(a){console.log(a),b.podcasts=a,b.fullyLoaded=!0})})}function HomePageCtrl(a,b,c,d,e,f){function g(){for(var b=null,c=0;c<a.podcasts.length;c++)if(a.podcasts[c].selected){b=c;break}return b}function h(a,b){Zeus.searchPodcastOnITunes(a,function(a,c){if(a)throw a;console.log(c.results),b.resolve(c.results)})}var i;a.podcasts=b.podcasts,a.podcastInfo={},console.log(a.podcasts),a.closePodcastModal=function(){f.hide()},a.openPodcastModal=function(a){f.show({parent:angular.element(document.body),targetEvent:a,clickOutsideToClose:!0,contentElement:"#addPodcastModal"})},a.addNewPodcast=function(b){return a.podcastInfo.hasError=!1,a.loadingRSSFeed=!0,b.url.match(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/)?void Zeus.fetchPodcastRSS(b.url,!0,null,function(b,d){return b||!d?(a.podcastInfo.errorMessage="Error: "+String(b),a.podcastInfo.hasError=!0,void(a.loadingRSSFeed=!1)):(a.podcastInfo.url="",a.loadingRSSFeed=!1,void c(function(){f.hide(),a.loadingPodcasts=!1,a.$apply()},2e3))}):(a.podcastInfo.errorMessage="Invalid URL",a.podcastInfo.hasError=!0,void(a.loadingRSSFeed=!1))},a.searchForPodcast=function(a){var b=e.defer();return console.log(a),c.cancel(i),i=c(function(){h(a,b)},2e3),b.promise},a.autocompleteSelectItem=function(b){a.podcastInfo.url=b.feedUrl},a.refreshAllPodcasts=function(){for(var c=0;c<a.podcasts.length;c++)b.podcasts[c].loading=!0,Zeus.fetchPodcastRSS(a.podcasts[c].rssUrl,!1,a.podcasts[c].id,function(c,d,e){b.podcasts[e]=d,b.podcasts[e].loading=!1,a.podcasts[e].loading=!1,console.log(b.podcasts),a.$apply()})},a.selectPodcast=function(b,c){a.handlePodcastUnselect(c),a.podcasts[b.id].selected=!0},a.handlePodcastUnselect=function(b){if(!angular.element(b.srcElement).parent().attr("data-context-menu"))for(var c=0;c<a.podcasts.length;c++)a.podcasts[c].selected=!1},a.sharePodcast=function(a){g()},a.openPodcastWebpage=function(a){g()},a.downloadAllPodcasts=function(a){g()},a.deletePodcast=function(b){var c=g(),d=f.confirm().title('Remove podcast "'+a.podcasts[c].meta.title+'"?').ariaLabel("Remove podcast").targetEvent(b).ok("Remove").cancel("Cancel");f.show(d).then(function(){console.log("You chose to delete!")})},d.on("click",function(b){a.handlePodcastUnselect(b)})}function MainCtrl(a,b,c,d,e){b.$on("$routeChangeError",function(a,b,e,f){return e?void c.history.back():void d.url("/")}),a.hideFrame=function(){Main.hideWindow()},a.closeFrame=function(){Main.closeWindow()},e.on("click",function(a){a.srcElement.href&&a.srcElement.href.includes("http")&&(shell.openExternal(a.srcElement.href),a.preventDefault())})}function PlayerPageCtrl(a,b,c,d,e,f,g){a.showNotes=!1,a.alreadyCanPlayed=!1,a.podcast=b.podcasts[c.params.podcast],a.episode=b.podcasts[c.params.podcast].podcasts[c.params.episode],a.episode.playbackURL="../../userdata/podcasts/"+a.episode.hash+".mp3",b.nowPlaying.playing=!0,b.nowPlaying.podcastId=c.params.podcast,b.nowPlaying.episodeId=c.params.episode;var h=null;g.unlock=void 0,a.sound=g.load(a.episode.playbackURL),a.playback={currentlyPlaying:!1,hoverTime:"0:00:00",tooltipLeft:0,tooltipTop:0,showHoverPosition:!1,progress:0,volume:b.settings.volume,lastEpisode:function(){d.url("/play/"+c.params.podcast+"/"+(parseInt(c.params.episode)+1)),a.sound.pause()},replay10Seconds:function(){a.sound.currentTime-=10},playPodcast:function(){a.playback.currentlyPlaying=!0,a.sound.play(),h=e(function(){a.episode.currentTime=a.sound.currentTime,Zeus.updateSavedPodcast(a.podcast)},3e4)},pausePodcast:function(){a.playback.currentlyPlaying=!1,a.sound.pause(),angular.isDefined(h)&&(e.cancel(h),h=void 0)},forward30Seconds:function(){a.sound.currentTime+=30},nextEpisode:function(){d.url("/play/"+c.params.podcast+"/"+(parseInt(c.params.episode)-1)),a.sound.pause()},goToPosition:function(b){var c=document.getElementsByTagName("md-progress-linear")[0].clientWidth,d=b.offsetX,e=(d/c).round(4);a.sound.currentTime=Math.round((a.sound.remaining+a.sound.currentTime)*e)},showPosition:function(b){var c=document.getElementsByTagName("md-progress-linear")[0].clientWidth,d=b.offsetX,e=(d/c).round(4);a.playback.hoverTime=parseTime(Math.floor((a.sound.remaining+a.sound.currentTime)*e)),a.playback.tooltipLeft=b.pageX-28+"px",a.playback.tooltipTop=angular.element(document.querySelector("md-progress-linear")).prop("offsetTop")-23+"px",a.playback.showHoverPosition=!0}},angular.element(document.querySelector('[data-bind="episode.description"]')).html(a.episode.description),a.sound.volume=a.playback.volume/100,a.$watch("playback.volume",function(){a.sound.volume=a.playback.volume/100}),a.$watch("sound.canPlay",function(){a.alreadyCanPlayed||(a.alreadyCanPlayed=!0,a.sound.currentTime=a.episode.currentTime||0,f(function(){document.querySelector('span[ng-click="playback.playPodcast()"]').click()},100))}),e(function(){a.playback.progress=100*a.sound.progress},1e3)}function parseTime(a){var b=a,c="",d=0,e=0,f=0;return b>3599?(d=Math.floor(b/3600),e=Math.floor((b-3600*d)/60),f=b-(60*e+3600*d),1==d.toString().length&&(d="0"+Math.floor(b/3600).toString()),1==e.toString().length&&(e="0"+Math.floor((b-3600*d)/60).toString()),1==f.toString().length&&(f="0"+(b-(60*e+3600*d)).toString()),c=d+":"+e+":"+f):b>59?(e=Math.floor(b/60),f=b-60*e,1==e.toString().length&&(e="0"+Math.floor(b/60).toString()),1==f.toString().length&&(f="0"+(b-60*e).toString()),c=e+":"+f):(f=b,1==f.toString().length&&(f="0"+b.toString()),c=(b<10?"00:0":"00:")+b),c}function PodcastPageCtrl(a,b,c,d,e){if(a.podcast=b.podcasts[c.params.id],a.showUnplayedOnly=!0,!a.podcast)return void d.url("/");for(var f=0;f<a.podcast.podcasts.length;f++)a.podcast.podcasts[f].downloading=!1;a.downloadEpisode=function(b){a.podcast.podcasts[b].downloading=!0,a.podcast.podcasts[b].downloadPercent=0,Zeus.downloadEpisode(a.podcast.podcasts[b],function(c,d,f){return 1!=f?(console.log(f),a.podcast.podcasts[b].downloadPercent=f,void a.$apply()):(a.podcast.podcasts[b].downloadPercent=1,a.$apply(),void e(function(){a.podcast.podcasts[b].downloading=!1,a.podcast.podcasts[b].isDownloaded=!0},1e3))})},a.deleteEpisode=function(b){Zeus.deleteEpisode(a.podcast.podcasts[b],function(c){c&&(a.podcast.podcasts[b].isDownloaded=!1)})},a.playPodcast=function(b,c){a.podcast.podcasts[c].isDownloaded&&d.url("/play/"+b+"/"+c)},a.markAsWatched=function(b){a.podcast.podcasts[b].watched=!0,Zeus.updateSavedPodcast(a.podcast)}}function SettingPageCtrl(a,b){a.showAdvancedSettings=!1,a.settings=b.settings,a.saveSettings=function(){b.settings=a.settings,Zeus.saveSettings(b.settings)},a.revertSettings=function(){a.settings={theme:"light",animations:!0,analytics:!0,smartSpeed:!0,voiceBoost:!0,autoPlay:!0,volume:50,cacheImages:!0,autoUpdate:!0,playback:"download"},a.saveSettings()}}ngRightClick.$inject=["$parse"],routeConfig.$inject=["$stateProvider","$locationProvider"],runBlock.$inject=["$window","$rootScope","$location","$interval"],HomePageCtrl.$inject=["$scope","$rootScope","$timeout","$document","$q","$mdDialog"],MainCtrl.$inject=["$scope","$rootScope","$window","$location","$document"],PlayerPageCtrl.$inject=["$scope","$rootScope","$state","$location","$interval","$timeout","ngAudio"],SettingPageCtrl.$inject=["$scope","$rootScope"],PodcastPageCtrl.$inject=["$scope","$rootScope","$state","$location","$timeout"];var zeus=angular.module("zeus",["ui.router","ngAudio","ngAnimate","ngMaterial","ngContextMenu"]).config(routeConfig);angular.module("zeus").directive("podcastPanel",PodcastPanelDirective).directive("preloader",PreloaderDirective).directive("preloaderSmall",PreloaderSmallDirective).directive("preloaderSmallBlue",PreloaderSmallBlueDirective).directive("podcastEpisode",PodcastEpisodeDirective).directive("ngRightClick",ngRightClick),Number.prototype.round=function(a){return a=a||10,parseFloat(this.toFixed(a))};const shell=require("electron").shell;angular.module("zeus").run(runBlock);const remote=require("electron").remote,Menu=remote.Menu,MenuItem=remote.MenuItem,template=[{label:"Copy",accelerator:"CmdOrCtrl+C",role:"copy"},{label:"Reload",accelerator:"CmdOrCtrl+R",click:function(a,b){b&&b.reload()}},{label:"Toggle Dev. Tools",accelerator:"darwin"===process.platform?"Alt+Command+I":"Ctrl+Shift+I",click:function(a,b){b&&b.webContents.toggleDevTools()}}],menu=Menu.buildFromTemplate(template);angular.module("zeus").controller("HomePageCtrl",HomePageCtrl),angular.module("zeus").controller("MainCtrl",MainCtrl),angular.module("zeus").controller("PlayerPageCtrl",PlayerPageCtrl),angular.module("zeus").controller("PodcastPageCtrl",PodcastPageCtrl),angular.module("zeus").controller("SettingPageCtrl",SettingPageCtrl);